rule apt_win_applejeus_oct22 : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        description = "Detects AppleJeus DLL samples."
        date = "2022-11-03"
        hash1 = "82e67114d632795edf29ce1d50a4c1c444846d9e16cd121ce26e63c8dc4a1629"
        memory_suitable = 1
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $s1 = "HijackingLib.dll" ascii

    condition:
        $s1
}

rule apt_win_applejeus_b_oct22 : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        date = "2022-11-03"
        description = "Detected AppleJeus unpacked samples."
        hash1 = "9352625b3e6a3c998e328e11ad43efb5602fe669aed9c9388af5f55fadfedc78"
        memory_suitable = 1
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $key1 = "AppX7y4nbzq37zn4ks9k7amqjywdat7d"
        $key2 = "Gd2n5frvG2eZ1KOe"

        $str1 = "Windows %d(%d)-%s"
        $str2 = "&act=check"

    condition:
        (
            any of ($key*) and
            1 of ($str*)
        ) or
        all of ($str*)
}

rule apt_win_applejeus_c_oct22 : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        date = "2022-11-03"
        description = "Detected AppleJeus unpacked samples."
        hash1 = "a0db8f8f13a27df1eacbc01505f311f6b14cf9b84fbc7e84cb764a13f001dbbb"
        memory_suitable = 1
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $str1 = "%sd.e%sc \"%s > %s 2>&1\"" wide
        $str2 = "tuid"
        $str3 = "content"
        $str4 = "payload"
        $str5 = "fconn"
        $str6 = "Mozilla_%lu"

    condition:
        5 of them
}

rule apt_win_applejeus_d_oct22 : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        date = "2022-11-10"
        description = "Detected AppleJeus unpacked samples."
        hash1 = "a241b6611afba8bb1de69044115483adb74f66ab4a80f7423e13c652422cb379"
        memory_suitable = 1
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $reg = "Software\\Bitcoin\\Bitcoin-Qt"
        $pattern = "%s=%d&%s=%s&%s=%s&%s=%d"
        $exec = " \"%s\", RaitingSetupUI "
        $http = "Accept: */*" wide
        
    condition:
        all of them    
}

rule cf_office_win_macro_lazarus_jeus_b : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        description = "Detects macros used by the Lazarus threat actor to distribute AppleJeus."
        date = "2022-11-03"
        hash1 = "17e6189c19dedea678969e042c64de2a51dd9fba69ff521571d63fd92e48601b"
        memory_suitable = 0
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $a1 = ", vbDirectory) = \"\" Then" ascii
        $a2 = ".Caption & " ascii
        $a3 = ".nodeTypedValue" ascii
        $a4 = ".Application.Visible = False" ascii
        $a5 = " MkDir (" ascii

    condition:
        all of ($a*)
}

rule cf_office_win_macro_lazarus_jeus : Lazarus
{
    meta:
        author = "threatintel@volexity.com"
        date = "2022-11-02"
        description = "Detects malicious documents used by Lazarus in a campaign dropping the AppleJeus malware."
        hash1 = "17e6189c19dedea678969e042c64de2a51dd9fba69ff521571d63fd92e48601b"
        memory_suitable = 1
        license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"

    strings:
        $s1 = "0M8R4K" ascii
        $s2 = "bin.base64" ascii
        $s3 = "dragon" ascii
        $s4 = "Workbook_Open" ascii

    condition:
       3 of ($s*) 
}

